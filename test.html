<input type="email" id="email" placeholder="Email">
  <input type="password" id="password" placeholder="Mot de passe">
  <div>
    <button id="loginBtn">Se connecter</button>
    <button id="registerBtn">Créer un compte</button>
  </div>

  <p>Ou directement sur GoAffPro: <a href="https://ritashape.goaffpro.com/create-account" target="_blank">Créer un compte GoAffPro</a></p>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyDglecP8nta6SdYcPyw-W7zNLXWNSBJeUE",
      authDomain: "collabify-auth-d8d6b.firebaseapp.com",
      projectId: "collabify-auth-d8d6b",
      storageBucket: "collabify-auth-d8d6b.appspot.com",
      messagingSenderId: "961892589399",
      appId: "1:961892589399:web:5c27628458f0cc78886812"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    const loginBtn = document.getElementById("loginBtn");
    const registerBtn = document.getElementById("registerBtn");

    // Redirect to GoAffPro via serverless function
    async function redirectToGoAffPro(email) {
      const res = await fetch("/api/goaffpro-sso", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email })
      });
      const data = await res.json();
      window.location.href = data.redirect;
    }

    // Login
    loginBtn.addEventListener("click", async () => {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;

      try {
        const userCredential = await signInWithEmailAndPassword(auth, email, password);
        await redirectToGoAffPro(userCredential.user.email);
      } catch (error) {
        alert("❌ " + error.message);
      }
    });

    // Register
    registerBtn.addEventListener("click", async () => {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;

      try {
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        await redirectToGoAffPro(userCredential.user.email);
      } catch (error) {
        alert("❌ " + error.message);
      }
    });
  </script>